<html>
<head>
	<title>testing</title>
	<script src="https://code.jquery.com/jquery-3.1.0.js"></script>
	<script type="text/javascript" src="js/buttonFunctions.js"></script>
	<script type="text/javascript" src="js/firebaseFunctions.js"></script>
	<script type="text/javascript" src="js/session.js"></script>
	<script type="text/javascript" src="classes/user.js"></script>
	<script type="text/javascript" src="classes/moderator.js"></script>
	<script type="text/javascript" src="classes/admin.js"></script>
	<script type="text/javascript" src="classes/app.js"></script>
	<script type="text/javascript" src="classes/appItem.js"></script>
	<script type="text/javascript" src="classes/comment.js"></script>

	<script type="text/javascript" src="js/firebase.js"></script>
	<!-- CSS -->
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">


</head>
<body>
	<header>
		<h1>AppHub</h1>
		<p id="welcome-user">Welcome collin!</p>
		<div id="header-buttons">
			<a href="login.html" class="header-button" id="login-button">
				<button id="header-logIn">Login</button></a>
			<a href="createAccount.html"  class="header-button" id="create-button">
				<button id="header-createAccount">Create an Account</button></a>
			<a href="appProposal.html" class="header-button" id="proposal-button">
				<button>Submit an App</button>
			</a>
			<a href="#" class="header-button" id="signout-button" onclick="signOut()">
				<button>Sign Out</button>
			</a>

		</div>
	</header>

	<div class="app-container">
		<h1 id="appName"></h1>
		<div class="pure-u-1-5 version"><p><b>Version</b></p></div>
		<div class="pure-u-1-5 price"><p><b>Price</b></p></div>
		<div class="pure-u-1-5"><p><b>Developers</b></p><ul class="devs"></ul></div>
		<div class="pure-u-1-5"><p><b>Platforms</b></p><ul class="plats"></ul></div>
		<div class="pure-u-1-5 link"><p><b>Link to Store</b></p></div>
		<div class="description"><p><b>Description</b></p></div>
		<div id="comment-section">
			<h3>Comments</h3>
			<div id="make-comment">
				<h4>Make a comment</h4>
					<p>Title</p>
					<input type="text" id="comment-title-input">
					<p>Body</p>
					<textarea rows="10" cols="75" id="comment-body-input"></textarea>
					<!-- submitComment() in script of this page -->
					<p class="comment-error" style="color:red;"></p>
					<p class="comment-success" style="color:green;"></p>
					<button onclick="submitComment()">Submit</button> 
			</div>
			<ul id="comments">

			</ul>
		</div>
	</div>	

	<script type="text/javascript">
		var appKey;
		$(document).ready(function(){
			appKey = window.location.href.substring(window.location.href.indexOf('=')+1);
			//console.log(appKey);
			getApp(appKey);
			//if there is no user logged in, don't show the comment form
			if(activeUser == null){
				$("#make-comment").css("display","none");
			}
		});

		function displayApp(app){
			if(app) console.log("yes app ");
			$("#appName").append(app.name);
			$(".version").append(app.version);
			$(".price").append(app.price);
			$(".devs").append(listElements(app.devs));
			$(".plats").append(listElements(app.platforms));
			$(".link").append('<a href="'+app.link+'">Link Name</a>');
			$(".description").append(app.desc);
		}

		function submitComment(){
			let title = $.trim($("#comment-title-input").val());
			let body = $.trim($("#comment-body-input").val());
			//check to make sure the comment is valid
			if(title.length > MAX_COMMENT_TITLE_LENGTH){
				$(".comment-error").append("Title length too long. Must be below "+ MAX_COMMENT_TITLE_LENGTH +" characters");
			}else if(body.length > MAX_COMMENT_BODY_LENGTH){
				$(".comment-error").append("Body length too long. Must be below "+ MAX_COMMENT_BODY_LENGTH +" characters");
			}else{
				$(".comment-error").empty();
				$(".comment-success").empty();
				$(".comment-success").append("Comment successful!");

				let com = new Comment(activeUser, title, body);
				addComment(appKey, com); //firebaseFunctions.js
			}
		}

	</script>

</body>
</html>